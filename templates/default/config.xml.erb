<?xml version="1.0" encoding="UTF-8"?>
<!-- Auto-generated by Chef for <%= node.name %> -->
<config version="1.0">
  <!--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  Configuration file template
  -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-->
  <category name="HealthMonitor" platform="win">
    <category name="PerformanceCounters">
      <item name="SampleCount">6</item>
      <item name="SampleRate">5000</item>
      <item name="GenerateLog">1</item>
      <item name="LogRollTime">24</item>
      <item name="LogMaxDirSize">20480</item>
      <category name="\Processor(_Total)\% Processor Time">
        <item name="WarningThreshold">90</item>
        <item name="ErrorThreshold">95</item>
        <item name="Operation">gte</item>
      </category>
      <category name="\Memory\Pool Nonpaged Bytes">
        <item name="WarningThreshold">234881024</item>
        <item name="ErrorThreshold">251658240</item>
        <item name="Operation">gte</item>
      </category>
      <category name="\Memory\Pool Paged Bytes">
        <item name="WarningThreshold">180000000</item>
        <item name="ErrorThreshold">210000000</item>
        <item name="Operation">gte</item>
      </category>
      <category name="vcs\virtual bytes">
        <!-- Windows 32bit can only access up to 2gb of memory -->
        <item name="WarningThreshold" osplatform="win32">1700000000</item>
        <item name="ErrorThreshold" osplatform="win32">1900000000</item>
        <!-- linux 32bit can only access up to 4gb of memory -->
        <item name="WarningThreshold" osplatform="linuxx86">3700000000</item>
        <item name="ErrorThreshold" osplatform="linuxx86">3900000000</item>
        <!-- only log info and perfmon stats for 64bit OSes as these values can get greater than 128gb -->
        <item name="InfoThreshold" osplatform="win64">3700000000</item>
        <item name="InfoThreshold" osplatform="linuxx64">3700000000</item>
        <item name="Operation">gte</item>
      </category>
    </category>
  </category>
  <category name="PlatformHooks">
    <category name="CallRouter">
      <item name="HookIP">0.0.0.0:5060</item>
      <item name="OverrideScript">http://127.0.0.1:9990/callrouter.xml</item>
      <item name="Handler">CCXML</item>
      <item name="Condition">Community</item>
    </category>
    <category name="VXML">
      <!-- all the call destined for VXML will be handled by CCXML and execute the OverrideScript -->
      <item name="HookPlatform">VXML</item>
      <item name="OverrideScript">http://127.0.0.1:9990/voicexml-start.xml</item>
      <item name="Handler">CCXML</item>
    </category>
    <category name="VXMLTransfer">
      <item name="HookIP">0.0.0.0:5065</item>
      <!-- note that there's no platform hook for this entry;
                 every call coming to this IP/port combination will be handled by CCXML and execute the OverrideScript -->
      <item name="OverrideScript">http://127.0.0.1:9990/voicexml-transfer-sbc.xml</item>
      <item name="Handler">CCXML</item>
    </category>
    <category name="SCXML">
      <!-- all the call destined for SCXML will be handled by CCXML and execute the OverrideScript -->
      <item name="HookPlatform">SCXML</item>
      <item name="OverrideScript">http://127.0.0.1:9990/scxml-start.xml</item>
      <item name="Handler">CCXML</item>
    </category>
    <category name="Designer">
      <!-- all the call destined for Designer will be handled by CCXML and execute the OverrideScript -->
      <item name="HookPlatform">Designer</item>
      <item name="OverrideScript">http://127.0.0.1:9990/voicexml-start.xml</item>
      <item name="Handler">CCXML</item>
    </category>
  </category>
  <category name="DNS">
    <% node[:prism][:vcs][:dns_servers].each_with_index do |server,index| -%>
      <%= "<item name='Server#{index+1}'>#{server}</item>" %>
    <% end -%>
  </category>
  <category name="IO">
    <item name="SMTPServer"><%= node[:prism][:vcs][:smtp_server] %></item>
    <item name="TempFolder"><%= @prism_path %>/logs/vio</item>
    <item name="SMTPPort"><%= node[:prism][:vcs][:smtp_port] %></item>

    <% node[:prism][:vcs][:proxies].each_with_index do |server,index| %>
      <%= "<item name='Proxy1#{index+1}'>#{server}</item>" %>
    <% end %>

    <item name="AllowLocalFileAccess"><%=node[:prism][:vcs][:allow_local_file_access]%></item>
  </category>
  <category name="NAT">
    <% if node[:prism][:nat_mode] -%>
    <item name="NATMapping0"><%= "#{@local_ipv4}=#{@public_ipv4}/#{@netmask}</item>" %>
    <% else -%>
    <item name="NATMapping0"/>
    <%end -%>
  </category>
  <category name="Media">
    <item name="ConferenceManagerURL"><%= node[:prism][:vcs][:conference_manager_url] %></item>
  </category>
  <!--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  Logging category.
  -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-->
  <category name="Log">
    <item name="AlertUri"/>
    <item name="MeterAlarmThreshold" type="int">64</item>
    <item name="MeteringEncryptionKey"/>
    <item name="MeteringLogFile">  ./logs/vcs/metering_cannot_send.log</item>
    <item name="MeteringLoggerAddress0"/>
    <item name="EncryptionKey"/>
    <item name="FileBase"><%= node[:prism][:vcs][:file_base] %></item>
    <item name="MaskDebug" type="int">2</item>
    <item name="MaskHighLevel" type="int">2</item>
    <item name="MaskLowLevel" type="int">2</item>
    <item name="MaskSession" type="int">2</item>
    <item name="MaskUser" type="int">6</item>
    <item name="MaxFileSize" type="int"><%= node[:prism][:vcs][:max_file_size] %></item>
    <item name="MaxNumOfFiles" type="int"><%= node[:prism][:vcs][:max_number_of_files] %></item>
    <item name="RetryDelay" type="int">5</item>
    <item name="SysLogEnabled" type="int">1</item>
    <item name="SysLogFilter" type="int">-1</item>
    <item name="SysLogBroadCast" type="int">1</item>
    <% node[:prism][:syslog_servers].each_with_index do |host,index| -%>
      <%= "<item name='SysLogServer#{index}'>#{host}</item>" %>
    <% end -%>
  </category>
  <!--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  RTP Library configuration
  -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-->
  <category name="Rtp">
    <item name="CheckPacketSource"><%=node[:prism][:vcs][:check_packet_source].eql?(true) ? 1 : 0 %></item>
  <% if node[:prism][:vcs][:sdp_parser_page_size] -%>
    <item name="SDPParserPageSize" type="int"> <%=node[:prism][:vcs][:sdp_parser_page_size] %> </item>
  <% end -%>
    <category name="Gain">
      <item name="GainLevelIn">0</item>
      <item name="GainLevelOut">0</item>
    </category>
  <% if node[:prism][:vcs][:initial_rtp_clients_count] -%>
    <item name="InitialRTPClientsCount"><%= node[:prism][:vcs][:initial_rtp_clients_count] %></item>
  <% end -%>
    <category name="SDPCodecs">
    <!--
      Setting to 0 will cause SDP answer to be formed is based on order of the codecs presented in the offer;
      otherwise use local codec priorities.
      Default: 0 (disabled)
    -->
    <item name='ForceLocalCodecPriorities'><%= node["prism"]["config"]["Rtp"]["ForceLocalCodecPriorities"] ? 1 : 0 %></item>
    <% node["prism"]["config"]["Rtp"]["SDPCodecs"].each do |codec| %>
    <%= "<category name='#{codec[:name]}'>" %>
    <% if codec[:priority] -%>
    <%= "<item name='Priority'>#{codec[:priority]}</item>"%>
    <% end -%>
    <%= "<item name='Disabled'>#{codec[:disabled] ? 1 : 0}</item>" %>
    <%= "</category>" %>
    <% end -%>
  </category>
    <item name="BasePort" type="int"><%= node[:prism][:config][:Rtp][:BasePort]%></item>
    <item name="PayloadSize" type="int"><%= node[:prism][:config][:Rtp][:PayloadSize]%></item>
    <item name="SocketBuffer" type="int"><%= node[:prism][:config][:Rtp][:SocketBuffer]%> </item>
    <item name="DTMFDuration" type="int"><%= node[:prism][:config][:Rtp][:DTMFDuration]%></item>
    <item name="DTMFPause" type="int"> <%= node[:prism][:config][:Rtp][:DTMFPause]%></item>
    <item name="TimerResolution" type="int"> 5 </item>
    <item name="JitterMinPackets" type="int"> 2 </item>
    <item name="JitterMaxPackets" type="int"> 4 </item>
    <item name="JitterMaxPacketRetransmit" type="int"> 10 </item>
    <category name="NAT" reference="/NAT"/>
  </category>
 <!--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  MRCP server category. Always top-level.
 -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-->
 <category name="MRCPSRV">
  <item name="ForceCallRecordDebug"><%= node[:prism][:mcrp][:force_call_recording_debug] ? 1 : 0 %></item>
  <item name="LogLevel"><%=node[:prism][:mcrp][:log_level]%></item>
  <item name="IP"><%=node[:prism][:mcrp][:listen_ip]%></item>
  <item name="Port" type="int"> <%=node[:prism][:mrcp][:port]%> </item>
  <item name="WaveformURI">    http://127.0.0.1:8080/com.voxeo.prism.msctrl/MRCP/Utterances/   </item>
  <item name="WaveformFolder"> <%= @prism_path %>/server/apps/com.voxeo.prism.msctrl/MRCP/Utterances</item>
  <item name="ForceWaveformRecording" type="int">0</item>
  <item name="PusherFolder"> <%= @prism_path %>/server/apps/com.voxeo.prism.msctrl/MRCP/Recordings </item>
  <item name="InputBufferSizeMs">90</item>
  <item name="OutputBufferSizeMs">90</item>
  <category name="Rtp" reference="/RTP"/>
  <category name="TTS" reference="/TTS"/>
 </category>
 <!--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  TTS manager/engines config.
 -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-->
 <category name="TTS">
   <item name="DefaultVoice"> <%= node["prism"]["config"]["TTS"]["DefaultVoice"] %> </item>
   <item name="AutoDetectSSML" type="int">1</item>
   <item name="VoiceMappings" platform="<%= node["prism"]["config"]["TTS"]["platform"]%>">
       <%= node["prism"]["config"]["TTS"]["VoiceMappings"].map{|m| "#{m["voice"]}=#{m["mapping"]}"}.join(",\n")  %>
   </item>
   <category name="vxttsloq7" platform="<%= node["prism"]["config"]["TTS"]["platform"]%>"/>
   <!-- define voices that may failover one to another , if case conversion through one of them fails -->
   <item name="FailoverGroup1" platform="<%=node["prism"]["config"]["TTS"]["platform"]%>"> <%= node["prism"]["config"]["TTS"]["FailoverGroup1"].join(",")%></item>

   <!-- Master cache control. Not caching at all if not specified -->
   <category name="Cache">
     <item name="DiskCache"><%=node["prism"]["config"]["TTS"]["Cache"]["DiskCache"]%></item>
     <item name="DiskCacheSize"><%=node["prism"]["config"]["TTS"]["Cache"]["DiskCacheSize"]%>MB</item>
     <item name="MemoryCacheSize"><%=node["prism"]["config"]["TTS"]["Cache"]["MemoryCacheSize"]%></item>
     <item name="MaxItems" type="int"><%=node["prism"]["config"]["TTS"]["Cache"]["MaxItems"]%></item>
   </category>
   <category name="vxttsprl">
     <item name="Voice1">English-Female4</item>
     <item name="Voice2">English-Male4</item>
     <item name="Voice3">Chinese-Female4</item>
     <item name="Voice4">Japan-Female4</item>
     <item name="Voice5">Japan-Male4</item>
     <item name="Voice6">Korean-Female4</item>
     <item name="Voice7">Korean-Male4</item>
     <item name="Voice8">Spanish-Female4</item>
     <item name="Separators"/>
     <item name="DataLocation"> <%= @prism_path %>/data/TTS </item>
     <item name="CachingEnabled" type="int">1</item>
     <item name="MaxVoicesInMemory" type="int">0</item>
   </category>
   <category name="vxttssapi" platform="win">
     <item name="Separators"/>
     <item name="CachingEnabled" type="int">1</item>
   </category>
   <category name="vxttsmrcp" private="true">
     <% @tts_engines.each_with_index do |voice,index| -%>
    <category name="Voice<%=index+1%>">
      <category name="ServerGroup">
      <% voice[:servers].each_with_index do |server,index| -%>
        <item name="Server<%=index%>"><%=voice[:servers][index]%></item>
      <% end -%>
      </category>
      <category name="MRCPParams">
        <item name="Speech-Language"><%=voice[:lang]%></item>
        <item name="Voice-name"><%=voice[:name]%></item>
      </category>
    </category>
    <% end-%>
     <item name="IgnoreCSeqErrors">1</item>
     <item name="ConnectTimeout">10000</item>
     <item name="SessionCacheType">none</item>
     <item name="RequestTimeout">10000</item>
     <item name="Separators"/>
     <item name="CachingEnabled">0</item>
   </category>
 </category>
 <!--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  VCS Services
 -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-->
 <category name="AGS1">
   <item name="HTTPCtrlPort" type="int"><%= node["prism"]["config"]["AGS1"]["HTTPCtrlPort"] %></item>
   <category name="CallRouting">
     <item name="Active">mc2</item>
   </category>
   <category name="Romeo2">
     <item name="AccuRule">                    AND     </item>
     <item name="AgentTimeout" type="int">     5000    </item>
     <item name="ScanInterval" type="int">     1000    </item>
     <item name="ScanLog" type="int">     0       </item>
     <item name="ScanWait" type="int">     500000  </item>
     <category name="ccxml.dlg.application/xml+vxml">
       <item name="HandledTypes0">ccxml.dlg.application/xml+vxml;ppid=5064</item>
       <item name="HandledTypes1">ccxml.dlg.application/voicexml+xml</item>
       <item name="HandledTypes2">ccxml.dlg.application/voicexml+xml;ppid=5064</item>
       <category name="127.0.0.1:5066">
               </category>
     </category>
     <category name="ccxml.dlg.application/xml+scxml">
       <category name="127.0.0.1:5066">
             </category>
     </category>
     <category name="ccxml.dlg.application/x-callxml">
       <category name="127.0.0.1:5061">
             </category>
     </category>
   </category>
   <item name="AllowLocalFileAccess" type="int">     0                                                     </item>
   <item name="DebugPauseTimeout" type="int">     300                                                      </item>
   <!-- Determines whether the machine acts as a redirect server or not -->
   <item name="IsRomeoRouter" type="int">     0                                                       </item>
   <!-- Value for variable that locks session space in CallXML -->
   <item name="SessionVarLockKey">                     123456789                                               </item>
   <!-- password that needs to be embedded in session trigger token -->
   <item name="TriggerPassword">                       password                                                </item>
   <item name="MaxDocSize" type="int">64000</item>
   <item name="MaxParseLoops" type="int">200</item>
   <item name="PassCalledID" type="int">     1                                                       </item>
   <item name="RecordCallNamingScheme">premise</item>
   <item name="RecordCallPath"><%= @prism_path %>/server/apps/com.voxeo.prism.msctrl/MRCP/Recordings</item>
   <item name="XMLValidation" type="int">     1                                                       </item>
 </category>
 <!--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  ASR
 -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-->
 <category name="ASR">
   <item name="EngineMappings">
    dtmf=vxsredtmf,
     <%= @asr_engines.map{|eng|"#{eng[:lang]}=#{eng[:engine]}"}.join ",\n\t" %>
   </item>
   <item name="BuiltInGrammars"><%= @prism_path %>/server/apps/com.voxeo.prism.msctrl/grammars/en-us</item>
   <category name="VXSREPR">
     <category name="Cache">
       <item name="DiskCache"> <%= @prism_path %>/Cache/Grammars </item>
       <item name="DiskCacheSize">50MB</item>
       <item name="MemoryCacheSize">10MB</item>
       <item name="MaxItems" type="int">1024</item>
     </category>
     <category name="Endpointer">
       <item name="SOSMinDuration">0.15</item>
       <item name="SOSMinEnergy">28</item>
       <item name="SOSPadLength">0.35</item>
     </category>
     <item name="MinConfidence" type="int">30</item>
   </category>
   <category name="VXSREDTMF"/>
   <category name="vxsremrcp">
     <category name="Groups">
     <% @asr_engines.each do |asr| -%>
       <% if asr[:engine].eql?("vxsremrcp") -%>
         <category name='<%=asr[:lang]%>'>
           <item name='Servers'><%=asr[:servers].join(",")%></item>
           <% if asr[:grammar_format] -%>
           <item name='GrammarFormat'><%=asr[:grammar_format]%></item>
           <% end -%>
           <% if asr[:ignore_cseq_errors] -%>
           <item name='IgnoreCSeqErrors' type='int'>1</item>
            <% end -%>
         </category>
       <% end -%>
     <% end -%>
     </category>
     <category name="Rtp" reference="/RTP"/>
    </category>
    <% if @use_sensory %>
      <category name="vxsresensory">
        <!-- Log level for the module; 1-9 -->
        <item name="LogLevel">7</item>
        <item name="BuiltInFolder"><%= @prism_path %>/data/ASR/sensory/grammars</item>
        <item name="UtteranceBasePath"><%= @prism_path %>/logs/utterances/sensory</item>
        <item name="ForceUtteranceRecording">0</item>

        <category name="com.sensory">
          <item name="useendpointer">0</item>
          <category name="<%= @asr_engines.find { |e| e[:engine] == 'vxsresensory' }[:lang] %>">
            <item name="acousticmodel"><%= @prism_path %>/data/ASR/sensory/en_us_8kHz_v8/nn_en_us_mfcc_8k_15_big_250_v4.7.raw</item>
            <item name="pronunsmodel"><%= @prism_path %>/data/ASR/sensory/en_us_8kHz_v8/lts_en_us_9.3.raw</item>
          </category>
        </category>
      </category>
    <% end %>
  </category>
</config>
